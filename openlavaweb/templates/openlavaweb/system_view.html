{% extends "openlavaweb/base.html" %}
{% block content %}
	
<h1>{{ cluster.name }}</h1>
<dl class="dl-horizontal">
	<dt>Cluster Name:</dt><dd>{{ cluster.name }}</dd>
	<dt>Master Host:</dt><dd>{{ cluster.master.name }}</dd>
	<dt>Admins:</dt><dd>{% for admin in cluster.admins %}{{ admin }}{% if not forloop.last %}<br />{% endif %}{% endfor %}</dd>
</dl>
<div class="container">
    <div class="row">
		<div class="col-md-4" id="hostChart"><h3>Host State</h3><svg width="100%"></svg></div>
		<div class="col-md-4" id="jobUtilChart"><h3>Job Utilization</h3><svg width="100%"></svg></div>
		<div class="col-md-4" id="slotUtilChart"><h3>Slot Utilization</h3><svg width="100%"></svg></div>
    </div>
</div>


<script>

function add_standard_pie(url, selector){
	d3.json(url,function(error,data){
		var chart;
   		nv.addGraph(function() {
        	chart = nv.models.pieChart()
        	//.margin({top: 30, right: 20, bottom: 50, left: 175})
        	.showLabels(true)     //Display pie labels
        	.labelThreshold(.05)  //Configure the minimum slice size for labels to show up
        	.labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
        	.donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
        	.donutRatio(0.35)     //Configure how big you want the donut hole size to be.
        	.x(function(d) { return d.label })
        	.y(function(d) { return d.value })
        	;
	
	        d3.select(selector)
	        .datum(data)
	        .transition().duration(500)
	        .call(chart);
	
	        nv.utils.windowResize(chart.update);
	
	        return chart;
    	});
	});
}

add_standard_pie("{% url "olw_system_overview_slots" %}","#slotUtilChart svg");
add_standard_pie("{% url "olw_system_overview_jobs" %}","#jobsUtilChart svg");
add_standard_pie("{% url "olw_system_overview_hosts" %}",'#hostChart svg');
</script>


<h1>Problem Hosts</h1>
{% include "openlavaweb/widgets/host_list.html" with host_list=cluster.problem_hosts %}

<h1>Queue Utilization</h1>
{% include "openlavaweb/widgets/queue_list.html" with queue_list=cluster.queues %}

<h1>Active Users</h1>
{% include "openlavaweb/widgets/user_list.html" with user_list=cluster.users %}

<h1>Resources</h1>
{% include "openlavaweb/widgets/resource_list.html" with resource_list=cluster.resources%}

{% endblock %}
