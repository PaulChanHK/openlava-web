{% extends "openlavaweb/base.html" %}
{% block content %}
<h1>Job: {{ job.job_id }} {% if job.array_array_index > 0 %} Array Index: {{ job.array_index }}{% endif %}</h1>
<dl class="dl-horizontal">
	<dt>Job ID</dt><dd data-toggle="tooltip" title="The job ID that the LSF system assigned to the job.">{{ job.job_id }}</dd>
	<dt>Array Index ID</dt><dd data-toggle="tooltip" title="The Array ID that the LSF system assigned to the job.">{{ job.array_index }}</dd>
	<dt>Status</dt>	<dd data-toggle="tooltip" id="status" title="The current status of the job.Possible values areshown in job_states.">{{ job.status.friendly }}: {{ job.status.description }}</dd>
	<dt>Username</dt><dd data-toggle="tooltip" title="The name of the user who submitted the job."><a href='{% url "olw_user_view" job.user_name %}'>{{ job.user_name }}</a></dd>
	<dt>Process ID</dt><dd id="pid" data-toggle="tooltip" title="The job process ID.">{{ job.process_id }}</dd>
	<dt>CPU Time Consumed</dt><dd data-toggle="tooltip" title="The time the job was submitted.">{{ job.cpu_time_timedelta }}</dd>
	<dt>Current Working Directory</dt><dd data-toggle="tooltip" title="The current working directory when the job was submitted.">{{ job.cwd }}</dd>
	<dt>Submission Host</dt><dd data-toggle="tooltip" title="The name of the host from which the job was submitted.">{{ job.submission_host.host_name }}</dd>
	<dt>Execution Hosts</dt><dd id="execution_hosts" data-toggle="tooltip" title="Names of hosts on which the job executes.">{% for h in job.execution_hosts %} <a href='{% url "olw_host_view" h.host_name %}'>{{ h.host_name }}</a> {% endfor %}</dd>
	<dt>Job Name</dt><dd data-toggle="tooltip" title="The name of the job">{{ job.name }}</dd>
	<dt>Job Priority</dt><dd id="priority" data-toggle="tooltip" title="Job dynamic priority.">{{ job.priority }}</dd>
	<dt>Submission Time</dt><dd data-toggle="tooltip" title="The time the job was submitted.">{{ job.submit_time_datetime_local }}</dd>
	<dt>Reservation Time</dt><dd data-toggle="tooltip" title="Time when job slots are reserved.">{{ job.reservation_time_datetime_local }}</dd>
	<dt>Start Time</dt><dd id="start_time" data-toggle="tooltip" title="The time that the job started running, if it has been dispatched.">{{ job.start_time_datetime_local}}</dd>
	<dt>Predicted Start Time</dt><dd id="predicted_start_time" data-toggle="tooltip" title="Job's predicted start time.">{{ job.predicted_start_time_datetime_local }}</dd>
	<dt>End Time</dt><dd id="end_time" data-toggle="tooltip" title="The termination time of the job, if it has completed.">{{ job.end_time_datetime_local }}</dd>
	<dt>Options</dt><dd>{% for option in job.options %}{{ option.friendly }}<br>{% endfor %}</dd>
	<dt>Job Name</dt><dd>{{ job.submit.job_name }}</dd>
	<dt>Queue Name</dt><dd><a href="{% url "olw_queue_view" job.queue.name %}">{{ job.queue.name }}</a></dd>
	<dt>Requested Hosts</dt><dd>{% for host in job.requested_hosts %}{{ host.name }} {% empty %}No hosts requested{% endfor %}</dd>
	<dt>Requested Resources</dt><dd>{{ job.requested_resources }}</dd>
	<dt>Max Num Processors</dt><dd>{{ job.max_requested_slots }}</dd>
	<dt>Dependency Conditions</dt><dd>{{ job.dependency_condition }}</dd>
	<dt>Begin Time</dt><dd>{{ job.begin_time_datetime_local }}</dd>
	<dt>Termination Deadline</dt><dd>{{ job.termination_time_datetime_local }}</dd>
	<dt>Input File</dt><dd>{{ job.input_file_name }}</dd>
	<dt>Output File</dt><dd>{{ job.output_file_name }}</dd>
	<dt>Error File</dt><dd>{{ job.error_file_name }}</dd>
	<dt>Command</dt><dd>{{ job.submit.command }}</dd>
	<dt>Email User</dt><dd>{{ job.email_user }}</dd>
	<dt>Project</dt><dd>{% for project in job.project_names %}{{ project }} {% empty %}No Projects {% endfor %}</dd>
	<dt>Groups</dt><dd>{% for group in job.group_names %}{{ group }} {% empty %}No groups{% endfor %}<dd>
	<dt>User Priority</dt><dd>{{ job.user_priority }}</dd>

	{% if job.cluster_type == "openlava" %}
	<dt>Checkpoint Period</dt><dd>{% if job.checkpoint_period > 0 %}{{ job.checkpoint_period_timedelta }}{% else %}Not checkpointable{% endif %}</dd>
	<dt>Checkpoint Dir</dt><dd>{{ job.checkpoint_directory|default:"Not checkpointable" }}</dd>
	<dt>CPU Factor</dt><dd id="cpu_factor" data-toggle="tooltip" title="The CPU factor for normalizing CPU and wall clock time limits.">{{ job.cpu_factor }}</dd>
	<dt>Execution Current Working Directory</dt><dd id="execution_cwd"  data-toggle="tooltip" title="Current working directory for the job on the execution host.">{{ job.execution_cwd }}</dd>
	<dt>Execution Home Directory</dt><dd id="execution_home_dir" data-toggle="tooltip" title="Home directory for the job on the execution host.">{{ job.execution_home_directory }}</dd>
	<dt>Execution User</dt><dd>{{ job.execution_user_name }} ({{ job.execution_user_id }})</dd>
	<dt>Host Specification</dt><dd>{{ job.host_specification }}</dd>
	<dt>Number of Processors</dt><dd>{{ job.requested_slots }}</dd>
	<dt>Login Shell</dt><dd>{{ job.login_shell|default:"Default"}}</dd>
	<dt>Parent Group</dt><dd id="parent_group" data-toggle="tooltip" title="The parent job group of a job or job group.">{{ job.parent_group }}</dd>
	<dt>Pre Execution Command</dt><dd>{{ job.pre_execution_command|default:"Not Specified" }}</dd>
	<dt>Resource Usage Last Updated</dt><dd id="resource_usage_last_update_time" data-toggle="tooltip" title="Time of the last job resource usage update.">{{ job.resource_usage_last_update_time_local }}</dd>
	<dt>Service Port</dt><dd id="service_port" data-toggle="tooltip" title="Service port of the job.">{{ job.service_port }}</dd>
	<dt>Submit Home Directory</dt><dd data-toggle="tooltip" title="Home directory on submission host.">{{ job.submit_home_directory }}</dd>
	<dt>Termination Signal Value</dt><dd>{{ job.termination_value|default:"Not Specified" }}</dd>
	{% endif %}
</dl>


<h1>Runtime Resource Limits</h1>
<table class="table table-striped table-condensed">
    <thead>
        <tr>
            <th>Resource</th>
            <th>Soft Limit</th>
            <th>Hard Limit</th>
        </tr>
    </thead>
    <tbody>
		{% for res in job.runtime_limits %}
        <tr>
			<td>{{ res.name }}</td>
			<td>{% if job.cluster_type == "openlava" and res.soft_limit == -1 %}Unlimited{% else %} {{ res.soft_limit }}{% if res.unit %} {{ res.unit }}{% endif %}{% endif %}</td>
			<td>{% if job.cluster_type == "openlava" and res.hard_limit == -1 %}Unlimited{% else %} {{ res.hard_limit }}{% if res.unit %} {{ res.unit }}{% endif %}{% endif %}</td>
        </tr>
		{% endfor %}
	</tbody>
</table>

{% if job.submit.num_transfer_files > 0 %}
	<h1>Files to Transfer</h1>
	<table class="table table-hover table-condensed">
		<thead>
			<tr>
				<th>Local File</th>
				<th>Remote File</th>
				<th>Options</th>
			</tr>
		</thead>
		<tbody>
		{% for file in job.submit.transfer_files %}
			<tr>
				<td>{{ file.submission_file_name }}</td>
				<td>{{ file.execution_file_name }}</td>
				<td>{{ file.options }}</td>
			</tr>
		{% endfor %}
	{% endif %}

	<h1>Resource Usage</h1>
	<table class="table table-hover table-condensed">
		<thead>
			<tr>
				<th>Field</th><th>Value</th><th>Limit</th>
			</tr>
		</thead>
<tbody>
		{% for res in job.consumed_resources %}
		<tr><th>{{ res.name }}</th><td>{{ res.value }}{% if res.unit %} {{ res.unit }}{% endif %}</td><td>{{ res.limit|default:"No Limit" }}</td></tr>
		{% endfor %}
	</tbody>
	</table>

	<h1>Active Processes</h1>
	<div id="active_processes">
		{% if job.processes %}
		<table class="table table-hover table-condensed">
			<thead>
				<tr>
					<th>Hostname</th>
					<th>Process ID</th>
					{% if job.cluster_type == "openlava" %}
					<th>Parent Process ID</th>
					<th>Group ID</th>
					<th>Cray Job ID</th>
					{% endif %}
				</tr>
			</thead>
			<tbody>
				{% for proc in job.processes %}
				<tr>
					<td>{{ proc.hostname|default:"Unknown" }}</td>
					<td>{{ proc.process_id }}</td>
					{% if job.cluster_type == "openlava" %}
					<td>{{ proc.parent_process_id }} </td>
					<td>{{ proc.process_group_id }}</td>
					<td>{{ proc.cray_job_id }}</td>
					{% endif %}
				</tr>
				{% endfor %}
			</tbody>
		</table>
	{% else %}
		<div class="alert alert-info">No processes yet.</div>
	{% endif %}
</div>


{% endblock %}
